/**
 * ============================================================================
 * 文件作用：解决方案详情 API 端点 (Solution Detail API Endpoint)
 * ============================================================================
 * 
 * 此文件是一个 Nitro 服务器 API 端点，用于获取单个解决方案的详细信息。
 * 
 * 路由：GET /api/solutions/[slug]
 * 
 * 功能说明：
 * 1. 根据 slug 获取单个解决方案详情
 * 2. 验证解决方案是否存在
 * 3. 返回解决方案数据或 404 错误
 * 
 * 参数：
 * - slug：解决方案的 URL 标识符（动态路由参数）
 * 
 * 返回值（成功）：
 * {
 *   success: true,              // 操作成功
 *   data: Solution              // 解决方案对象
 * }
 * 
 * 返回值（失败）：
 * - HTTP 404 Not Found：解决方案不存在
 * 
 * 工作流程：
 * 1. 从 URL 路径中提取 slug 参数
 * 2. 在 mock 数据中查找对应的解决方案
 * 3. 如果找到，返回解决方案数据
 * 4. 如果未找到，抛出 404 错误
 * 
 * Mock 数据说明：
 * - 当前使用 mock 数据（~/utils/mockData）
 * - 实际项目应该从 Supabase 数据库获取
 * - 可以通过替换 mockSolutions.find() 为数据库查询来实现
 * 
 * 数据验证：
 * 1. slug 参数验证：确保 slug 存在
 * 2. 解决方案存在性验证：确保解决方案存在
 * 3. 错误处理：返回友好的 404 错误消息
 * 
 * 性能优化：
 * - 内存查找：在内存中进行查找，无需数据库支持
 * - 可扩展：可以替换为数据库查询，支持索引优化
 * 
 * 实际项目建议：
 * - 替换 mock 数据为 Supabase 数据库查询
 * - 添加缓存机制（减少数据库查询）
 * - 使用数据库索引（提升查询性能）
 * 
 * ============================================================================
 */

// ============================================================================
// 导入依赖项
// ============================================================================

// 导入 mock 数据
// ~/utils/mockData：mock 数据文件
// mockSolutions：解决方案的 mock 数据数组
import { mockSolutions } from '~/utils/mockData'

// ============================================================================
// Nitro 服务器 API 端点定义
// ============================================================================

// defineEventHandler：Nuxt 3/Nitro 提供的函数，用于定义服务器 API 端点
// - event：Nuxt 事件对象，包含请求信息
export default defineEventHandler((event) => {
  // ============================================================================
  // 获取路由参数 (Get Route Parameter)
  // ============================================================================
  // 
  // getRouterParam：Nitro 提供的工具函数，用于获取路由参数
  // - event：Nuxt 事件对象
  // - 'slug'：参数名称（与动态路由 [slug] 对应）
  // 
  // 返回值：
  // - 字符串：slug 参数的值
  // - undefined：参数不存在
  // 
  // 使用场景：
  // - 访问 URL：/api/solutions/idc-solution
  // - slug 参数值为：'idc-solution'
  // 
  // ============================================================================
  const slug = getRouterParam(event, 'slug')

  // ============================================================================
  // 查找解决方案 (Find Solution)
  // ============================================================================
  // 
  // mockSolutions：解决方案的 mock 数据数组
  // .find()：数组查找方法，返回第一个满足条件的元素
  // (s => s.slug === slug)：查找条件，查找 slug 字段等于参数的解决方案
  // 
  // 返回值：
  // - Solution 对象：找到对应的解决方案
  // - undefined：未找到对应的解决方案
  // 
  // 查找逻辑：
  // - 遍历 mockSolutions 数组
  // - 检查每个解决方案的 slug 字段
  // - 返回第一个匹配的解决方案
  // 
  // 示例说明：
  // - slug = 'idc-solution'
  // - mockSolutions = [{ slug: 'idc-solution', ... }, { slug: 'ops-solution', ... }]
  // - 查找结果：{ slug: 'idc-solution', ... }
  // 
  // 为什么使用 find()？
  // - slug 是唯一的，只需要找到第一个匹配项
  // - 性能优于 filter()（找到后立即返回）
  // - 返回单个对象，而不是数组
  // 
  // ============================================================================
  const solution = mockSolutions.find(s => s.slug === slug)

  // ============================================================================
  // 验证解决方案是否存在 (Validate Solution Exists)
  // ============================================================================
  // 
  // 如果 solution 为 undefined 或 null，说明未找到对应的解决方案
  // 
  // 错误处理：
  // 1. 检查 solution 是否存在
  // 2. 如果不存在，抛出 404 错误
  // 3. 返回友好的错误消息
  //
  // createError：Nitro 提供的错误创建函数
  // - statusCode：HTTP 状态码（404 = Not Found）
  // - message：错误消息（Solution not found）
  //
  // 为什么要验证？
  // - 避免返回 null 或 undefined
  // - 提供友好的错误提示
  // - 符合 RESTful API 规范
  // 
  // ============================================================================
  if (!solution) {
    // 抛出 404 Not Found 错误
    // statusCode: 404：HTTP 状态码
    // message: 'Solution not found'：错误消息
    throw createError({
      statusCode: 404,
      message: 'Solution not found'
    })
  }

  // ============================================================================
  // 返回解决方案数据 (Return Solution Data)
  // ============================================================================
  // 
  // 返回对象说明：
  // - success：表示操作是否成功（布尔值）
  // - data：包含解决方案对象
  //
  // 使用场景：
  // - 前端调用此 API 获取解决方案详情
  // - 解决方案详情页（/solutions/[slug]）
  //
  // 返回格式：
  // {
  //   success: true,              // 操作成功
  //   data: Solution              // 解决方案对象
  // }
  // 
  // ============================================================================
  return {
    success: true,               // 操作成功
    data: solution               // 解决方案对象
  }
})
